{% extends 'layouts/intranet.html'%}
{% load static %}

{% block title %} Materiales {% endblock title %}

{% block content %}

    {% include 'common/breadcrumb.html' with title=title %}
    
    <div class="card border-0 shadow">
        <div class="card-header">
            <div class="row">
                <div class="col">
                    <div class="dropdown">
                        <a class="btn btn-gray-800 d-inline-flex align-items-center me-2 dropdown-toggle" onclick="return preguntar_cantidad('{{proveedor_id}}')" href="#">
                            <i class="fas fa-user-plus fa-xs me-3" aria-hidden="true"></i> Nuevo
                        </a>
                    </div>
                </div>
                <div class="col">
                    <form method="get" class="navbar-search form-inline">
                        {% csrf_token %}
                        <div class="input-group">
                            <input type="text" class="form-control" id="search" name="search" placeholder="Buscar por codigo del proveedor" aria-describedby="button-addon2">
                            <button class="btn btn-outline-primary" type="submit" id="button-addon2">
                                <i class="fas fa-search" aria-hidden="true"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-centered table-nowrap mb-0 rounded" aria-hidden="true">
                    <thead class="thead-light">
                        <tr>
                            <th id="col" class="border-0">...</th> 
                            <th id="col" class="border-0">Código del Proveedor</th>
                            <th id="col" class="border-0">Categoria</th>
                            <th id="col" class="border-0">Unidad de medida</th>
                            <th id="col" class="border-0">Cantidad contenedora</th>
                            <th id="col" class="border-0">Descripción</th>
                            <th id="col" class="border-0">Precio actual</th>
                            <th id="col" class="border-0">Fecha de vencimiento</th>
                            <th id="col" class="border-0">Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in materiales %}
                        <tr>
                            <td> 
                                <a href="{% url 'proveedores:materialesUpdate' proveedor_id=proveedor_id proveedor=proveedor id=item.id%}" class="text-info fw-bold">
                                    <i class="fas fa-edit" aria-hidden="true"></i>
                                </a>
                            </td>
                            <td>
                                {{ item.codigo_proveedor}}
                            </td>
                            <td>
                                {{ item.categoria.nombre}}
                            </td>
                            <td>
                                {{ item.unidad_medida.nombre}}
                            </td>
                            <td>
                                {{ item.cantidad_contenedora }}
                            </td>
                            <td>
                                {{ item.descripcion}}
                            </td>
                            <td>
                                {{ item.precio_actual }}
                            </td>
                            <td>
                                {{ item.fecha_vencimiento|date:"d/m/Y"  }}
                            </td>
                            <td>
                                <a href="{% url 'proveedores:materialesEstadoUpdate' proveedor=proveedor proveedor_id=proveedor_id id=item.id %}" class="fw-bold {% if item.estado == 'ACTIVO' %} text-success {% else %} text-danger {% endif %}">
                                    {{ item.estado }}
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% if is_paginated %}
    {% include 'common/pagination.html' %}
{% endif %}

<script>
    async function preguntar_cantidad(proveedor_id) {
        const { value: cantidad } = await Swal.fire({
            title: '¿Cuantos materiales quiere registrar?',
            input: 'number',
            inputLabel: 'Cantidad de material',
            showCancelButton: true,
            inputValidator: (value) => {
                if (!value) { return 'La cantidad es obligatorio' }                
                if (value % 1 != 0) { return 'La cantidad debe ser un entero'}
                if (value < 1) { return 'La cantidad minima es 1' }
                if (value > 10) { return 'La cantidad maxima es 10' }
            }
        })

        if (cantidad) {
            var url = "{% url 'proveedores:materialesCreate' proveedor_id=proveedor_id proveedor=proveedor %}";
            return document.location.href = url + "?cantidad=" + cantidad;
        }
    }
</script>

{% endblock content %}